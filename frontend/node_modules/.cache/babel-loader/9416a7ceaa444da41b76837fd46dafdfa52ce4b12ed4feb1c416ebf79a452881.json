{"ast":null,"code":"var _jsxFileName = \"C:\\\\Projetos App\\\\cresceja\\\\frontend\\\\src\\\\pages\\\\Billing\\\\CheckoutPage.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useMemo, useState } from \"react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport api from \"../../api/api\";\nimport { usePricing } from \"../../contexts/PricingContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction useQuery() {\n  _s();\n  const {\n    search\n  } = useLocation();\n  return useMemo(() => new URLSearchParams(search), [search]);\n}\n_s(useQuery, \"I+9F+Vhfmc3otMLqUKFlYflxhf8=\", false, function () {\n  return [useLocation];\n});\nexport default function CheckoutPage() {\n  _s2();\n  const query = useQuery();\n  const navigate = useNavigate();\n  const planId = query.get(\"plan\") || \"starter\";\n  const {\n    plans\n  } = usePricing();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const plan = (plans || []).find(p => p.id === planId) || (plans || [])[0];\n  const amount = plan === null || plan === void 0 ? void 0 : plan.monthlyPrice;\n  async function startCheckout() {\n    setLoading(true);\n    setError(null);\n    const payload = {\n      plan_id: plan === null || plan === void 0 ? void 0 : plan.id,\n      // URLs que o backend deve usar como retorno do provedor de pagamento:\n      success_url: `${window.location.origin}/checkout/success?plan=${plan === null || plan === void 0 ? void 0 : plan.id}`,\n      cancel_url: `${window.location.origin}/checkout/error?plan=${plan === null || plan === void 0 ? void 0 : plan.id}`\n    };\n    try {\n      var _res$data, _res$data2, _res$data3, _res$data4;\n      // Tente endpoints mais comuns\n      const res = await api.post(\"/billing/checkout\", payload);\n      const url = (res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.checkout_url) || (res === null || res === void 0 ? void 0 : (_res$data2 = res.data) === null || _res$data2 === void 0 ? void 0 : _res$data2.init_point) || (res === null || res === void 0 ? void 0 : (_res$data3 = res.data) === null || _res$data3 === void 0 ? void 0 : _res$data3.url);\n      if (url) {\n        window.location.href = url;\n        return;\n      }\n      // Stripe checkout session id, se vier sem url:\n      if (res !== null && res !== void 0 && (_res$data4 = res.data) !== null && _res$data4 !== void 0 && _res$data4.session_id) {\n        const s = res.data.session_id;\n        window.location.href = `${window.location.origin}/checkout/success?session_id=${encodeURIComponent(s)}&plan=${plan === null || plan === void 0 ? void 0 : plan.id}`;\n        return;\n      }\n      setError(\"Resposta do checkout não trouxe URL. Verifique o backend.\");\n    } catch (e1) {\n      try {\n        var _res2$data, _res2$data2, _res2$data3;\n        const res2 = await api.post(\"/payments/checkout\", payload);\n        const url2 = (res2 === null || res2 === void 0 ? void 0 : (_res2$data = res2.data) === null || _res2$data === void 0 ? void 0 : _res2$data.checkout_url) || (res2 === null || res2 === void 0 ? void 0 : (_res2$data2 = res2.data) === null || _res2$data2 === void 0 ? void 0 : _res2$data2.init_point) || (res2 === null || res2 === void 0 ? void 0 : (_res2$data3 = res2.data) === null || _res2$data3 === void 0 ? void 0 : _res2$data3.url);\n        if (url2) {\n          window.location.href = url2;\n          return;\n        }\n        setError(\"Resposta do checkout alternativa não trouxe URL.\");\n      } catch (e2) {\n        setError(\"Falha ao iniciar o checkout. Confirme se /billing/checkout ou /payments/checkout existem.\");\n      }\n    } finally {\n      setLoading(false);\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-6 space-y-6 max-w-2xl mx-auto\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"text-2xl font-semibold\",\n      children: \"Checkout\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this), plan ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-2xl shadow p-4 space-y-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-lg font-medium\",\n        children: [\"Plano: \", plan.name]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-2xl font-bold\",\n        children: [\"R$\", amount, /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-base text-gray-500\",\n          children: \"/m\\xEAs\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 57\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-4 bg-yellow-50 rounded-xl border\",\n      children: \"Nenhum plano encontrado. Retorne \\xE0 p\\xE1gina de planos.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 9\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-3 bg-red-50 text-red-700 rounded-xl border\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex gap-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: startCheckout,\n        disabled: loading,\n        className: \"px-4 py-2 rounded-xl bg-blue-600 text-white disabled:opacity-50\",\n        children: loading ? \"Redirecionando...\" : \"Pagar agora\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate(-1),\n        className: \"px-4 py-2 rounded-xl bg-gray-100\",\n        children: \"Voltar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-xs text-gray-500\",\n      children: \"O pagamento \\xE9 processado por provedor seguro (Stripe/Mercado Pago). Voc\\xEA ser\\xE1 redirecionado.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n}\n_s2(CheckoutPage, \"PF20EIb0HKGcXhlJIaCKktMZydQ=\", false, function () {\n  return [useQuery, useNavigate, usePricing];\n});\n_c = CheckoutPage;\nvar _c;\n$RefreshReg$(_c, \"CheckoutPage\");","map":{"version":3,"names":["React","useMemo","useState","useLocation","useNavigate","api","usePricing","jsxDEV","_jsxDEV","useQuery","_s","search","URLSearchParams","CheckoutPage","_s2","query","navigate","planId","get","plans","loading","setLoading","error","setError","plan","find","p","id","amount","monthlyPrice","startCheckout","payload","plan_id","success_url","window","location","origin","cancel_url","_res$data","_res$data2","_res$data3","_res$data4","res","post","url","data","checkout_url","init_point","href","session_id","s","encodeURIComponent","e1","_res2$data","_res2$data2","_res2$data3","res2","url2","e2","className","children","fileName","_jsxFileName","lineNumber","columnNumber","name","onClick","disabled","_c","$RefreshReg$"],"sources":["C:/Projetos App/cresceja/frontend/src/pages/Billing/CheckoutPage.jsx"],"sourcesContent":["import React, { useMemo, useState } from \"react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport api from \"../../api/api\";\nimport { usePricing } from \"../../contexts/PricingContext\";\n\nfunction useQuery() {\n  const { search } = useLocation();\n  return useMemo(() => new URLSearchParams(search), [search]);\n}\n\nexport default function CheckoutPage() {\n  const query = useQuery();\n  const navigate = useNavigate();\n  const planId = query.get(\"plan\") || \"starter\";\n  const { plans } = usePricing();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  const plan = (plans || []).find(p => p.id === planId) || (plans || [])[0];\n  const amount = plan?.monthlyPrice;\n\n  async function startCheckout() {\n    setLoading(true);\n    setError(null);\n    const payload = {\n      plan_id: plan?.id,\n      // URLs que o backend deve usar como retorno do provedor de pagamento:\n      success_url: `${window.location.origin}/checkout/success?plan=${plan?.id}`,\n      cancel_url: `${window.location.origin}/checkout/error?plan=${plan?.id}`,\n    };\n    try {\n      // Tente endpoints mais comuns\n      const res = await api.post(\"/billing/checkout\", payload);\n      const url = res?.data?.checkout_url || res?.data?.init_point || res?.data?.url;\n      if (url) {\n        window.location.href = url;\n        return;\n      }\n      // Stripe checkout session id, se vier sem url:\n      if (res?.data?.session_id) {\n        const s = res.data.session_id;\n        window.location.href = `${window.location.origin}/checkout/success?session_id=${encodeURIComponent(s)}&plan=${plan?.id}`;\n        return;\n      }\n      setError(\"Resposta do checkout não trouxe URL. Verifique o backend.\");\n    } catch (e1) {\n      try {\n        const res2 = await api.post(\"/payments/checkout\", payload);\n        const url2 = res2?.data?.checkout_url || res2?.data?.init_point || res2?.data?.url;\n        if (url2) {\n          window.location.href = url2;\n          return;\n        }\n        setError(\"Resposta do checkout alternativa não trouxe URL.\");\n      } catch (e2) {\n        setError(\"Falha ao iniciar o checkout. Confirme se /billing/checkout ou /payments/checkout existem.\");\n      }\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"p-6 space-y-6 max-w-2xl mx-auto\">\n      <h1 className=\"text-2xl font-semibold\">Checkout</h1>\n      {plan ? (\n        <div className=\"bg-white rounded-2xl shadow p-4 space-y-2\">\n          <div className=\"text-lg font-medium\">Plano: {plan.name}</div>\n          <div className=\"text-2xl font-bold\">R${amount}<span className=\"text-base text-gray-500\">/mês</span></div>\n        </div>\n      ) : (\n        <div className=\"p-4 bg-yellow-50 rounded-xl border\">Nenhum plano encontrado. Retorne à página de planos.</div>\n      )}\n      {error && <div className=\"p-3 bg-red-50 text-red-700 rounded-xl border\">{error}</div>}\n      <div className=\"flex gap-2\">\n        <button onClick={startCheckout} disabled={loading} className=\"px-4 py-2 rounded-xl bg-blue-600 text-white disabled:opacity-50\">\n          {loading ? \"Redirecionando...\" : \"Pagar agora\"}\n        </button>\n        <button onClick={() => navigate(-1)} className=\"px-4 py-2 rounded-xl bg-gray-100\">Voltar</button>\n      </div>\n      <p className=\"text-xs text-gray-500\">O pagamento é processado por provedor seguro (Stripe/Mercado Pago). Você será redirecionado.</p>\n    </div>\n  );\n}\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AAChD,SAASC,WAAW,EAAEC,WAAW,QAAQ,kBAAkB;AAC3D,OAAOC,GAAG,MAAM,eAAe;AAC/B,SAASC,UAAU,QAAQ,+BAA+B;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE3D,SAASC,QAAQA,CAAA,EAAG;EAAAC,EAAA;EAClB,MAAM;IAAEC;EAAO,CAAC,GAAGR,WAAW,CAAC,CAAC;EAChC,OAAOF,OAAO,CAAC,MAAM,IAAIW,eAAe,CAACD,MAAM,CAAC,EAAE,CAACA,MAAM,CAAC,CAAC;AAC7D;AAACD,EAAA,CAHQD,QAAQ;EAAA,QACIN,WAAW;AAAA;AAIhC,eAAe,SAASU,YAAYA,CAAA,EAAG;EAAAC,GAAA;EACrC,MAAMC,KAAK,GAAGN,QAAQ,CAAC,CAAC;EACxB,MAAMO,QAAQ,GAAGZ,WAAW,CAAC,CAAC;EAC9B,MAAMa,MAAM,GAAGF,KAAK,CAACG,GAAG,CAAC,MAAM,CAAC,IAAI,SAAS;EAC7C,MAAM;IAAEC;EAAM,CAAC,GAAGb,UAAU,CAAC,CAAC;EAC9B,MAAM,CAACc,OAAO,EAAEC,UAAU,CAAC,GAAGnB,QAAQ,CAAC,KAAK,CAAC;EAC7C,MAAM,CAACoB,KAAK,EAAEC,QAAQ,CAAC,GAAGrB,QAAQ,CAAC,IAAI,CAAC;EAExC,MAAMsB,IAAI,GAAG,CAACL,KAAK,IAAI,EAAE,EAAEM,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,EAAE,KAAKV,MAAM,CAAC,IAAI,CAACE,KAAK,IAAI,EAAE,EAAE,CAAC,CAAC;EACzE,MAAMS,MAAM,GAAGJ,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEK,YAAY;EAEjC,eAAeC,aAAaA,CAAA,EAAG;IAC7BT,UAAU,CAAC,IAAI,CAAC;IAChBE,QAAQ,CAAC,IAAI,CAAC;IACd,MAAMQ,OAAO,GAAG;MACdC,OAAO,EAAER,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEG,EAAE;MACjB;MACAM,WAAW,EAAE,GAAGC,MAAM,CAACC,QAAQ,CAACC,MAAM,0BAA0BZ,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEG,EAAE,EAAE;MAC1EU,UAAU,EAAE,GAAGH,MAAM,CAACC,QAAQ,CAACC,MAAM,wBAAwBZ,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEG,EAAE;IACvE,CAAC;IACD,IAAI;MAAA,IAAAW,SAAA,EAAAC,UAAA,EAAAC,UAAA,EAAAC,UAAA;MACF;MACA,MAAMC,GAAG,GAAG,MAAMrC,GAAG,CAACsC,IAAI,CAAC,mBAAmB,EAAEZ,OAAO,CAAC;MACxD,MAAMa,GAAG,GAAG,CAAAF,GAAG,aAAHA,GAAG,wBAAAJ,SAAA,GAAHI,GAAG,CAAEG,IAAI,cAAAP,SAAA,uBAATA,SAAA,CAAWQ,YAAY,MAAIJ,GAAG,aAAHA,GAAG,wBAAAH,UAAA,GAAHG,GAAG,CAAEG,IAAI,cAAAN,UAAA,uBAATA,UAAA,CAAWQ,UAAU,MAAIL,GAAG,aAAHA,GAAG,wBAAAF,UAAA,GAAHE,GAAG,CAAEG,IAAI,cAAAL,UAAA,uBAATA,UAAA,CAAWI,GAAG;MAC9E,IAAIA,GAAG,EAAE;QACPV,MAAM,CAACC,QAAQ,CAACa,IAAI,GAAGJ,GAAG;QAC1B;MACF;MACA;MACA,IAAIF,GAAG,aAAHA,GAAG,gBAAAD,UAAA,GAAHC,GAAG,CAAEG,IAAI,cAAAJ,UAAA,eAATA,UAAA,CAAWQ,UAAU,EAAE;QACzB,MAAMC,CAAC,GAAGR,GAAG,CAACG,IAAI,CAACI,UAAU;QAC7Bf,MAAM,CAACC,QAAQ,CAACa,IAAI,GAAG,GAAGd,MAAM,CAACC,QAAQ,CAACC,MAAM,gCAAgCe,kBAAkB,CAACD,CAAC,CAAC,SAAS1B,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEG,EAAE,EAAE;QACxH;MACF;MACAJ,QAAQ,CAAC,2DAA2D,CAAC;IACvE,CAAC,CAAC,OAAO6B,EAAE,EAAE;MACX,IAAI;QAAA,IAAAC,UAAA,EAAAC,WAAA,EAAAC,WAAA;QACF,MAAMC,IAAI,GAAG,MAAMnD,GAAG,CAACsC,IAAI,CAAC,oBAAoB,EAAEZ,OAAO,CAAC;QAC1D,MAAM0B,IAAI,GAAG,CAAAD,IAAI,aAAJA,IAAI,wBAAAH,UAAA,GAAJG,IAAI,CAAEX,IAAI,cAAAQ,UAAA,uBAAVA,UAAA,CAAYP,YAAY,MAAIU,IAAI,aAAJA,IAAI,wBAAAF,WAAA,GAAJE,IAAI,CAAEX,IAAI,cAAAS,WAAA,uBAAVA,WAAA,CAAYP,UAAU,MAAIS,IAAI,aAAJA,IAAI,wBAAAD,WAAA,GAAJC,IAAI,CAAEX,IAAI,cAAAU,WAAA,uBAAVA,WAAA,CAAYX,GAAG;QAClF,IAAIa,IAAI,EAAE;UACRvB,MAAM,CAACC,QAAQ,CAACa,IAAI,GAAGS,IAAI;UAC3B;QACF;QACAlC,QAAQ,CAAC,kDAAkD,CAAC;MAC9D,CAAC,CAAC,OAAOmC,EAAE,EAAE;QACXnC,QAAQ,CAAC,2FAA2F,CAAC;MACvG;IACF,CAAC,SAAS;MACRF,UAAU,CAAC,KAAK,CAAC;IACnB;EACF;EAEA,oBACEb,OAAA;IAAKmD,SAAS,EAAC,iCAAiC;IAAAC,QAAA,gBAC9CpD,OAAA;MAAImD,SAAS,EAAC,wBAAwB;MAAAC,QAAA,EAAC;IAAQ;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,EACnDxC,IAAI,gBACHhB,OAAA;MAAKmD,SAAS,EAAC,2CAA2C;MAAAC,QAAA,gBACxDpD,OAAA;QAAKmD,SAAS,EAAC,qBAAqB;QAAAC,QAAA,GAAC,SAAO,EAACpC,IAAI,CAACyC,IAAI;MAAA;QAAAJ,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAM,CAAC,eAC7DxD,OAAA;QAAKmD,SAAS,EAAC,oBAAoB;QAAAC,QAAA,GAAC,IAAE,EAAChC,MAAM,eAACpB,OAAA;UAAMmD,SAAS,EAAC,yBAAyB;UAAAC,QAAA,EAAC;QAAI;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACtG,CAAC,gBAENxD,OAAA;MAAKmD,SAAS,EAAC,oCAAoC;MAAAC,QAAA,EAAC;IAAoD;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CAC9G,EACA1C,KAAK,iBAAId,OAAA;MAAKmD,SAAS,EAAC,8CAA8C;MAAAC,QAAA,EAAEtC;IAAK;MAAAuC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAM,CAAC,eACrFxD,OAAA;MAAKmD,SAAS,EAAC,YAAY;MAAAC,QAAA,gBACzBpD,OAAA;QAAQ0D,OAAO,EAAEpC,aAAc;QAACqC,QAAQ,EAAE/C,OAAQ;QAACuC,SAAS,EAAC,iEAAiE;QAAAC,QAAA,EAC3HxC,OAAO,GAAG,mBAAmB,GAAG;MAAa;QAAAyC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACxC,CAAC,eACTxD,OAAA;QAAQ0D,OAAO,EAAEA,CAAA,KAAMlD,QAAQ,CAAC,CAAC,CAAC,CAAE;QAAC2C,SAAS,EAAC,kCAAkC;QAAAC,QAAA,EAAC;MAAM;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC9F,CAAC,eACNxD,OAAA;MAAGmD,SAAS,EAAC,uBAAuB;MAAAC,QAAA,EAAC;IAA4F;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAG,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAClI,CAAC;AAEV;AAAClD,GAAA,CAzEuBD,YAAY;EAAA,QACpBJ,QAAQ,EACLL,WAAW,EAEVE,UAAU;AAAA;AAAA8D,EAAA,GAJNvD,YAAY;AAAA,IAAAuD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}