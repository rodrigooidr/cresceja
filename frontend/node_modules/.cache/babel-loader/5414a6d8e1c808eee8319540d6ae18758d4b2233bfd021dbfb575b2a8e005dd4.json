{"ast":null,"code":"var _jsxFileName = \"C:\\\\Projetos App\\\\cresceja\\\\frontend\\\\src\\\\contexts\\\\TrialContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useState, useCallback } from \"react\";\nimport api from \"../api/api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst TrialContext = /*#__PURE__*/createContext({\n  trialDays: 14,\n  loading: true,\n  refresh: () => {}\n});\nexport function TrialProvider({\n  children\n}) {\n  _s();\n  const [trialDays, setTrialDays] = useState(14);\n  const [loading, setLoading] = useState(true);\n  const refresh = useCallback(async () => {\n    setLoading(true);\n    try {\n      var _ref, _free$trial_days;\n      const {\n        data\n      } = await api.get(\"/api/public/plans\");\n      const list = Array.isArray(data === null || data === void 0 ? void 0 : data.plans) ? data.plans : Array.isArray(data) ? data : [];\n      const free = list.find(p => p.id === \"free\") || list.find(p => {\n        var _p$name;\n        return p.is_free || ((_p$name = p.name) === null || _p$name === void 0 ? void 0 : _p$name.toLowerCase()) === \"free\";\n      });\n      const td = Number((_ref = (_free$trial_days = free === null || free === void 0 ? void 0 : free.trial_days) !== null && _free$trial_days !== void 0 ? _free$trial_days : free === null || free === void 0 ? void 0 : free.trialDays) !== null && _ref !== void 0 ? _ref : 14);\n      const valid = Number.isFinite(td) && td >= 0 ? td : 14;\n      setTrialDays(valid);\n      localStorage.setItem(\"trialDays\", String(valid));\n      localStorage.setItem(\"trialDays_ts\", String(Date.now()));\n    } catch {\n      const cached = Number(localStorage.getItem(\"trialDays\"));\n      if (Number.isFinite(cached)) setTrialDays(cached);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n  useEffect(() => {\n    // TTL simples de 5 minutos para evitar bater na API a cada navegação\n    const ts = Number(localStorage.getItem(\"trialDays_ts\") || 0);\n    const age = Date.now() - ts;\n    const cached = Number(localStorage.getItem(\"trialDays\"));\n    if (age < 5 * 60 * 1000 && Number.isFinite(cached)) {\n      setTrialDays(cached);\n      setLoading(false);\n      // ainda assim fazemos refresh para garantir atualização\n      refresh();\n    } else {\n      refresh();\n    }\n\n    // AdminPlans pode disparar este evento após salvar -> atualiza instantâneo\n    const onAdminUpdate = () => refresh();\n    window.addEventListener(\"trial-updated\", onAdminUpdate);\n    return () => window.removeEventListener(\"trial-updated\", onAdminUpdate);\n  }, [refresh]);\n  return /*#__PURE__*/_jsxDEV(TrialContext.Provider, {\n    value: {\n      trialDays,\n      loading,\n      refresh\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 5\n  }, this);\n}\n_s(TrialProvider, \"IpmyOMnumnsBcTt0UKQ4tylN0eU=\");\n_c = TrialProvider;\nexport const useTrial = () => {\n  _s2();\n  return useContext(TrialContext);\n};\n_s2(useTrial, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"TrialProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useCallback","api","jsxDEV","_jsxDEV","TrialContext","trialDays","loading","refresh","TrialProvider","children","_s","setTrialDays","setLoading","_ref","_free$trial_days","data","get","list","Array","isArray","plans","free","find","p","id","_p$name","is_free","name","toLowerCase","td","Number","trial_days","valid","isFinite","localStorage","setItem","String","Date","now","cached","getItem","ts","age","onAdminUpdate","window","addEventListener","removeEventListener","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useTrial","_s2","$RefreshReg$"],"sources":["C:/Projetos App/cresceja/frontend/src/contexts/TrialContext.jsx"],"sourcesContent":["\r\nimport React, { createContext, useContext, useEffect, useState, useCallback } from \"react\";\r\nimport api from \"../api/api\";\r\n\r\nconst TrialContext = createContext({ trialDays: 14, loading: true, refresh: () => {} });\r\n\r\nexport function TrialProvider({ children }) {\r\n  const [trialDays, setTrialDays] = useState(14);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const refresh = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const { data } = await api.get(\"/api/public/plans\");\r\n      const list = Array.isArray(data?.plans) ? data.plans : Array.isArray(data) ? data : [];\r\n      const free =\r\n        list.find((p) => p.id === \"free\") ||\r\n        list.find((p) => p.is_free || p.name?.toLowerCase() === \"free\");\r\n      const td = Number(free?.trial_days ?? free?.trialDays ?? 14);\r\n      const valid = Number.isFinite(td) && td >= 0 ? td : 14;\r\n      setTrialDays(valid);\r\n      localStorage.setItem(\"trialDays\", String(valid));\r\n      localStorage.setItem(\"trialDays_ts\", String(Date.now()));\r\n    } catch {\r\n      const cached = Number(localStorage.getItem(\"trialDays\"));\r\n      if (Number.isFinite(cached)) setTrialDays(cached);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // TTL simples de 5 minutos para evitar bater na API a cada navegação\r\n    const ts = Number(localStorage.getItem(\"trialDays_ts\") || 0);\r\n    const age = Date.now() - ts;\r\n    const cached = Number(localStorage.getItem(\"trialDays\"));\r\n    if (age < 5 * 60 * 1000 && Number.isFinite(cached)) {\r\n      setTrialDays(cached);\r\n      setLoading(false);\r\n      // ainda assim fazemos refresh para garantir atualização\r\n      refresh();\r\n    } else {\r\n      refresh();\r\n    }\r\n\r\n    // AdminPlans pode disparar este evento após salvar -> atualiza instantâneo\r\n    const onAdminUpdate = () => refresh();\r\n    window.addEventListener(\"trial-updated\", onAdminUpdate);\r\n    return () => window.removeEventListener(\"trial-updated\", onAdminUpdate);\r\n  }, [refresh]);\r\n\r\n  return (\r\n    <TrialContext.Provider value={{ trialDays, loading, refresh }}>\r\n      {children}\r\n    </TrialContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useTrial = () => useContext(TrialContext);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}